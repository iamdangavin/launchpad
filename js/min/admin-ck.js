jQuery(document).ready(function(e){function t(){e(".launchpad-flexible-container, .launchpad-repeater-container").sortable({handle:"h3",opacity:.5,placeholder:"launchpad-flexible-container-placeholder",forcePlaceholderSize:!0,revert:!0,containment:"parent",axis:"y",items:"> div"}),e(".launchpad-relationship-items").sortable({handle:"a",opacity:.5,placeholder:"launchpad-flexible-container-placeholder",forcePlaceholderSize:!0,revert:!0,containment:"parent",axis:"y",items:"> li"})}function a(){var t=e.extend(!0,{},tinyMCEPreInit.mceInit.content),a=e.extend(!0,{},tinyMCEPreInit.qtInit.content),n=this.id;t.selector="#"+n,a.id=n,tinyMCEPreInit.mceInit[n]=t,tinyMCEPreInit.qtInit[n]=a,tinyMCE.init(t);try{QTags(a),QTags._buttonsInit()}catch(i){}switchEditors.switchto(e(t.selector).closest(".wp-editor-wrap").find(".wp-switch-editor.switch-"+("html"===getUserSetting("editor")?"html":"tmce")).get(0)),window.wpActiveEditor||(window.wpActiveEditor=n)}t(),e(document.body).on("click",".launchpad-file-button",function(t){var a=e(this),n=wp.media({title:"Upload File",button:{text:"Add File"},multiple:!1}).on("select",function(){var t=n.state().get("selection").first().toJSON(),i=e("#"+a.data("for")),l=i.parent().find(".launchpad-delete-file"),c;i.length?(i.attr("value",t.id),c=e('<a href="#" class="launchpad-delete-file" data-for="'+a.data("for")+"\" onclick=\"document.getElementById(this.getAttribute('data-for')).value=''; this.parentNode.removeChild(this); return false;\"><img src=\""+(t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url)+'"></a>'),l.length?l.replaceWith(c):i.parent().append(c)):alert("There was a problem attaching the media.  Please contact your developer.")}).open();t.stopImmediatePropagation(),t.preventDefault()}),e(document.body).on("click","button.launchpad-repeater-add",function(){var n=e(this),i=n.data("for"),l=e("#"+i),c=l.children().first().clone(),r="launchpad-"+(new Date).getTime()+"-repeater",o;c.find("[name]").each(function(){var t=e(this);t.attr("name",t.attr("name").replace(/launchpad\-.*?\-repeater/g,r)),t.is("input:not(checkbox)")&&t.val(""),t.is("select")&&t.val("")}),l.append(c),o=c.find("textarea.wp-editor-area"),o.length&&o.each(function(){for(var t=e(this),n=t.closest(".wp-editor-wrap"),i=n.attr("id").slice(3,-5),l=1;e("#wp-"+i+l+"-wrap").length;)l++;i+=l,n.addClass("launchpad-editor-loading"),e.get("/api/?action=get_editor&id="+i+"&name="+t.attr("name"),function(t){t=e(t),n.replaceWith(t),t.find("textarea.wp-editor-area").each(a),e(".wp-editor-wrap").off("click.wp-editor").on("click.wp-editor",function(){this.id&&(window.wpActiveEditor=this.id.slice(3,-5))})})}),t()}),e(document.body).on("click","a.launchpad-flexible-link",function(n){var i=e(this);n.preventDefault(),e.get("/api/?action=get_flexible_field&type="+i.data("launchpad-flexible-type")+"&name="+i.data("launchpad-flexible-name")+"&id="+i.data("launchpad-flexible-post-id"),function(n){console.log();var l;n=e(n),l=n.find("textarea.wp-editor-area"),e("#launchpad-flexible-container-"+i.data("launchpad-flexible-type")).append(n),l.length&&(l.each(a),e(".wp-editor-wrap").off("click.wp-editor").on("click.wp-editor",function(){this.id&&(window.wpActiveEditor=this.id.slice(3,-5))})),t()})}),e(document.body).on("keyup input",".launchpad-relationship-search-field",function(t){var a=e(this),n=a.closest(".launchpad-relationship-container"),i=n.find(".launchpad-relationship-list");("input"!==t.type||""===this.value.replace(/\s/,""))&&e.get("/api/?action=search_posts&post_type="+n.data("post-type")+"&terms="+a.val(),function(t){i.html(""),e.each(t,function(){i.append(e('<li><a href="#" data-id="'+this.ID+'">'+this.post_title+" <small>"+this.ancestor_chain+"</small></a></li>"))})})}).on("click",".launchpad-relationship-list a",function(t){var a=e(this),n=a.clone(),i=a.closest(".launchpad-relationship-container"),l=i.find(".launchpad-relationship-items"),c=i.data("field-name"),r=i.data("limit");console.log(t,this),t.preventDefault(),n.append(e('<input type="hidden" name="'+c+'" value="'+a.data("id")+'">')),!e('[value="'+a.data("id")+'"]',l).length&&("-1"===r||e("[value]",l).length<+r)&&(a=e("<li>"),a.css("height",0),a.append(n),l.append(a),a.animate({height:n.outerHeight()}))}).on("click",".launchpad-relationship-items a",function(t){var a=e(this);t.preventDefault(),a.parent().animate({height:0},function(){a.parent().remove()})}),e("textarea[maxlength]").keyup(function(t){var a=e(this),n;t.ctrlKey||t.altKey||t.metaKey||91===t.which||(console.log(t,t.which),a.val(a.val().substr(0,a.attr("maxlength"))),"number"==typeof this.selectionStart?this.selectionStart=this.selectionEnd=this.value.length:"undefined"!=typeof this.createTextRange&&(this.focus(),n=this.createTextRange(),n.collapse(!1),n.select()))}).add("input[maxlength]").on("keyup",function(){var t=e(this);t.parent().find(".launchpad-char-count").html(+t.attr("maxlength")-t.val().length)}).each(function(){var t=e(this),a=t.attr("maxlength");t.parent().append('<small>Characters Left: <span class="launchpad-char-count">'+(+a-t.val().length)+"</span> of "+a+"</small>")}),e('[name="launchpad_meta[SEO][title]"], [name="launchpad_meta[SEO][keyword]"]').keyup(function(){var t=e("#serp-heading"),a=e('[name="launchpad_meta[SEO][title]"]').val();a=a.replace(/^\s+/,"").replace(/\s+$/,""),""===a&&(a=t.data("post-title")),a&&t.html(a.substr(0,70).replace(new RegExp("("+e('[name="launchpad_meta[SEO][keyword]"]').val().replace(/\s+/g,"|")+")","ig"),"<strong>$1</strong>")+(a.length>70?" ...":""))}),e('[name="launchpad_meta[SEO][meta_description]"], [name="launchpad_meta[SEO][keyword]"]').keyup(function(){var t=e("#serp-meta"),a=e('[name="launchpad_meta[SEO][meta_description]"]').val();a=a.replace(/^\s+/,"").replace(/\s+$/,""),""===a&&(a=t.data("post-excerpt")),a&&t.html(a.substr(0,160).replace(new RegExp("("+e('[name="launchpad_meta[SEO][keyword]"]').val().replace(/\s+/g,"|")+")","ig"),"<strong>$1</strong>")+(a.length>160?" ...":""))})});